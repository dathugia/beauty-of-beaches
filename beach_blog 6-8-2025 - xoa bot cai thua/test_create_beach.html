<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Create Beach</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h1>Test Create Beach with Direct Input</h1>
    
    <form id="beachForm">
        <div class="form-group">
            <label for="name">Beach Name *</label>
            <input type="text" id="name" name="name" required placeholder="Enter beach name">
        </div>
        
        <div class="form-group">
            <label for="region_id">Region (Select existing)</label>
            <select id="region_id" name="region_id">
                <option value="">Select Region</option>
            </select>
        </div>
        
                 <div class="form-group">
             <label for="region_name">Or Enter New Region Name</label>
             <input type="text" id="region_name" name="region_name" placeholder="Enter new region name">
         </div>
         
         <div class="form-group">
             <label for="city">City Name</label>
             <input type="text" id="city" name="city" placeholder="Enter city name">
         </div>
        
        <div class="form-group">
            <label for="country">Country (Select existing)</label>
            <select id="country" name="country">
                <option value="">Select Country</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="country_new">Or Enter New Country Name</label>
            <input type="text" id="country_new" name="country_new" placeholder="Enter new country name">
        </div>
        
        <div class="form-group">
            <label for="description">Description</label>
            <textarea id="description" name="description" rows="3" placeholder="Enter beach description"></textarea>
        </div>
        
        <div class="form-group">
            <label for="image_url">Image URL</label>
            <input type="url" id="image_url" name="image_url" placeholder="https://example.com/image.jpg">
        </div>
        
        <div class="form-group">
            <label for="rank">Rank (optional)</label>
            <input type="number" id="rank" name="rank" min="0" value="0">
        </div>
        
        <button type="submit">Create Beach</button>
    </form>
    
    <div id="result"></div>

    <script>
        // Load regions and countries on page load
        window.onload = function() {
            loadRegions();
        };

        async function loadRegions() {
            try {
                const response = await fetch('http://localhost:8000/api/admin_beach.php?action=get_regions');
                const data = await response.json();
                
                if (data.success) {
                    // Populate regions dropdown
                    const regionSelect = document.getElementById('region_id');
                    data.regions.forEach(region => {
                        const option = document.createElement('option');
                        option.value = region.id;
                        option.textContent = region.name;
                        regionSelect.appendChild(option);
                    });
                    
                    // Populate countries dropdown
                    const countrySelect = document.getElementById('country');
                    data.countries.forEach(country => {
                        const option = document.createElement('option');
                        option.value = country;
                        option.textContent = country;
                        countrySelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading regions:', error);
            }
        }

        document.getElementById('beachForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
                         const data = {
                 action: 'create',
                 name: formData.get('name'),
                 region_id: formData.get('region_id') || 0,
                 region_name: formData.get('region_name'),
                 city: formData.get('city'),
                 country: formData.get('country'),
                 country_new: formData.get('country_new'),
                 description: formData.get('description'),
                 image_url: formData.get('image_url'),
                 rank: parseInt(formData.get('rank')) || 0
             };
            
            // Use country_new if provided and no country selected
            if (data.country_new && !data.country) {
                data.country = data.country_new;
            }
            
            try {
                const response = await fetch('http://localhost:8000/api/admin_beach.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                const resultDiv = document.getElementById('result');
                
                if (result.success) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <h3>Success!</h3>
                        <p>${result.message}</p>
                        <p>Beach ID: ${result.id}</p>
                        <p>Region ID: ${result.region_id}</p>
                    `;
                    e.target.reset();
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `
                        <h3>Error!</h3>
                        <p>${result.message}</p>
                    `;
                }
            } catch (error) {
                const resultDiv = document.getElementById('result');
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <h3>Error!</h3>
                    <p>Network error: ${error.message}</p>
                `;
            }
        });
    </script>
</body>
</html>
